(this.webpackJsonpclient=this.webpackJsonpclient||[]).push([[0],{212:function(e,t,n){},413:function(e,t,n){"use strict";n.r(t);var a=n(1),s=n.n(a),i=n(27),r=n.n(i),c=(n(212),n(69)),o=n(30),l=n(70),d=n(81),u=n(72),j=n.n(u),h=function(){return j.a.get("/api/readings").then((function(e){return e.data}))},b=function(){return j.a.get("/api/sensors").then((function(e){return e.data}))},m=n(24),x=n(3),g={month:"numeric",day:"numeric"},O={month:"numeric",day:"numeric",year:"numeric",hour:"numeric",minute:"numeric"},f=function(e){var t=e.data,n=e.yDataKeys,a=e.yUnit,s=e.yDomain,i=e.xDataKey,r=e.boundaries;return Object(x.jsx)(m.e,{width:"90%",height:300,children:Object(x.jsxs)(m.c,{cx:"50%",cy:"50%",outerRadius:"80%",data:t,children:[n.map((function(e){return Object(x.jsx)(m.b,{type:"monotone",dataKey:e,stroke:"#7D53DE",dot:!1,name:e.charAt(0).toUpperCase()+e.slice(1),unit:a},e)})),Object(x.jsx)(m.a,{stroke:"#ccc",vertical:!1}),Object(x.jsx)(m.g,{dataKey:i,tick:!1,type:"number",domain:["dataMin","dataMax"]}),Object(x.jsx)(m.h,{type:"number",domain:s,allowDecimals:!1}),Object(x.jsx)(m.f,{labelFormatter:function(e){return new Date(e).toLocaleDateString("en-GB",O)}}),r.map((function(e){return Object(x.jsx)(m.d,{x:e,stroke:"blue",label:new Date(e).toLocaleDateString("en-GB",g)},e)}))]})})},p=function(e){var t=e.user,n=(new Date).getHours();return n>=4&&n<=10?Object(x.jsxs)("div",{className:"greeting",children:["Good Morning ",Object(x.jsx)("br",{})," ",Object(x.jsx)("span",{children:t})]}):n>=22||n<=3?Object(x.jsxs)("div",{className:"greeting",children:["Good Night ",Object(x.jsx)("br",{})," ",Object(x.jsx)("span",{children:t})]}):n>=18&&n<22?Object(x.jsxs)("div",{className:"greeting",children:["Good Evening ",Object(x.jsx)("br",{})," ",Object(x.jsx)("span",{children:t})]}):Object(x.jsxs)("div",{className:"greeting",children:["Good Day ",Object(x.jsx)("br",{})," ",Object(x.jsx)("span",{children:t})]})},v=n(441),y={weekday:"long",month:"long",day:"numeric"},D=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).state={time:new Date},a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.intervalID=setInterval((function(){return e.tick()}),1e3)}},{key:"componentWillUnmount",value:function(){clearInterval(this.intervalID)}},{key:"tick",value:function(){this.setState({time:new Date})}},{key:"render",value:function(){return Object(x.jsxs)("div",{className:"timeDateDisplay",children:[Object(x.jsx)(v.a,{variant:"h2",children:this.state.time.toLocaleString(void 0,{hour:"2-digit",minute:"2-digit",second:"2-digit"})}),Object(x.jsx)(v.a,{variant:"h6",children:this.state.time.toLocaleDateString("en-GB",y)})]})}}]),n}(s.a.Component),S=function(e,t){var n=e.reduce((function(e,n){return e+n[t]}),0);return Math.round(n/e.length*100)/100},k=function(e){var t=e.data,n=e.boundaries;return Object(x.jsxs)("div",{children:[Object(x.jsx)(v.a,{variant:"h5",children:"Data Summary"}),Object(x.jsxs)("ul",{children:[Object(x.jsxs)("li",{children:[t.length," data points over ",n.length," days"]},"datapoints"),Object(x.jsxs)("li",{children:["Average temperature ",S(t,"temperature")]},"temp"),Object(x.jsxs)("li",{children:["Average humidity ",S(t,"humidity")]},"hum")]})]})},w=n(443),R=n(446),C=n(447),T=n(444),I=n(445),M=function(e){var t=e.sensors;return Object(x.jsxs)(a.Fragment,{children:[Object(x.jsx)(v.a,{variant:"h5",children:"Sensors"}),Object(x.jsxs)(w.a,{children:[Object(x.jsx)(T.a,{children:Object(x.jsxs)(I.a,{children:[Object(x.jsx)("th",{children:"Sensorname"}),Object(x.jsx)("th",{children:"First online"}),Object(x.jsx)("th",{children:"Last online"})]})}),Object(x.jsx)(R.a,{children:t.map((function(e){return Object(x.jsxs)(I.a,{children:[Object(x.jsx)(C.a,{children:e.name}),Object(x.jsx)(C.a,{children:new Date(e.firstonline).toLocaleString("fi-FI")}),Object(x.jsx)(C.a,{children:new Date(e.lastonline).toLocaleString("fi-FI")})]},e._id)}))})]})]})},B=n(10),G=n(448),K=n(450),L=n(449),N=n(451),A=function(e){Object(l.a)(n,e);var t=Object(d.a)(n);function n(e){var a;return Object(c.a)(this,n),(a=t.call(this,e)).selectSensor=function(e){return function(){console.log("Sensor ".concat(e," is being selected"));var t=e?a.state.readings.filter((function(t){return t.sensorname===e})):a.state.readings;a.setState({selectedSensor:e,chosenReadings:t})}},a.handleTabChange=function(e,t){a.setState({currentTab:t}),a.filterReadings()},a.handleRangeChange=function(e,t){a.setState({range:t}),a.filterReadings()},a.toMilliseconds=function(e){return 24*e*60*60*1e3},a.filterReadings=function(){var e=(a.selectedSensor?a.state.readings.filter((function(e){return e.sensorname===a.state.selectedSensor})):a.state.readings).filter((function(e){return(new Date).getTime()-new Date(e.date).getTime()<=a.toMilliseconds(a.state.range)}));a.setState({chosenReadings:e})},a.calculateDateBoundaries=function(){return a.state.chosenReadings.map((function(e){return new Date(e.date).setHours(0,0,0,0,0)})).filter((function(e,t,n){return n.indexOf(e)===t})).map((function(e){return new Date(e).getTime()}))},a.calculateAverage=function(e,t){var n=e.reduce((function(e,n){return e+n[t]}),0);return Math.round(n/e.length*100)/100},a.state={sensors:[],readings:[],chosenReadings:[],selectedSensor:void 0,currentTab:0,range:14},console.log("constructor"),a}return Object(o.a)(n,[{key:"componentDidMount",value:function(){var e=this;console.log("App did mount"),b().then((function(t){console.log("Sensors promise fulfilled"),e.setState({sensors:t,selectedSensor:t[0].name})})),h().then((function(t){console.log("Readings promise fulfilled"),e.setState({readings:t}),e.filterReadings()})),this.setState({currentTab:0})}},{key:"render",value:function(){var e=this,t=this.props.classes;return Object(x.jsxs)("div",{className:t.root,children:[Object(x.jsxs)(G.a,{container:!0,spacing:8,alignItems:"center",justify:"center",children:[Object(x.jsx)(G.a,{item:!0,xs:6,children:Object(x.jsx)(p,{user:"Ossian"})}),Object(x.jsx)(G.a,{item:!0,xs:6,children:Object(x.jsx)(D,{})})]}),Object(x.jsxs)(K.a,{value:this.state.currentTab,onChange:this.handleTabChange,indicatorColor:"primary",textColor:"primary",centered:!0,children:[Object(x.jsx)(L.a,{as:"button",onClick:this.selectSensor(void 0),label:"All"},"all"),this.state.sensors.map((function(t){return Object(x.jsx)(L.a,{as:"button",onClick:e.selectSensor(t.name),label:t.name},t.name)}))]}),Object(x.jsxs)(G.a,{container:!0,spacing:8,alignItems:"flex-start",justifyContent:"space-around",children:[Object(x.jsxs)(G.a,{item:!0,xs:10,md:8,children:[Object(x.jsx)(N.a,{classes:{container:t.slider},value:this.state.range,min:1,max:14,step:1,onChange:this.handleRangeChange}),Object(x.jsxs)("p",{children:[this.state.range," ",this.state.range<1?" hours":" day(s)"]})]}),Object(x.jsxs)(G.a,{item:!0,xs:12,md:6,children:[Object(x.jsx)(v.a,{align:"center",variant:"h5",children:"Temperature"}),Object(x.jsx)(f,{data:this.state.chosenReadings,yDataKeys:["temperature","temperatureOut"],yUnit:"\xb0",yDomain:[-10,30],xDataKey:"date",boundaries:this.calculateDateBoundaries()})]}),Object(x.jsxs)(G.a,{item:!0,xs:12,md:6,children:[Object(x.jsx)(v.a,{align:"center",variant:"h5",children:"Humidity"}),Object(x.jsx)(f,{data:this.state.chosenReadings,yDataKeys:["humidity","humidityOut"],yUnit:"%",yDomain:[10,100],xDataKey:"date",boundaries:this.calculateDateBoundaries()})]}),Object(x.jsx)(G.a,{item:!0,xs:12,md:3,children:Object(x.jsx)(k,{data:this.state.chosenReadings,boundaries:this.calculateDateBoundaries()})}),Object(x.jsx)(G.a,{item:!0,xs:12,md:8,children:Object(x.jsx)(M,{sensors:this.state.sensors})})]})]})}}]),n}(s.a.Component),F=Object(B.a)({root:{flexGrow:1},slider:{padding:"22px 0px"}})(A);r.a.render(Object(x.jsx)(F,{}),document.getElementById("root"))}},[[413,1,2]]]);
//# sourceMappingURL=main.4fce9e19.chunk.js.map